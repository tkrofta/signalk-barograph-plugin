(self.webpackChunksignalk_barograph=self.webpackChunksignalk_barograph||[]).push([[957],{2801:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return T}});var r=a(7865),n=a.n(r),s=a(5546),i=a(3457),o=(0,r.createContext)(),l=a(5697),c=a.n(l),m=a(5834),u=a(3832),p=a(1749),d=a(2318),g=a(7107),f=a(5305);const h=(0,r.createContext)(),v=e=>{const t=(0,r.useContext)(h),[a,s]=(0,r.useState)(Date.now()),[i,o]=(0,r.useState)([e.classes.autoRefresh,e.classes.refreshStart]);if(null!==e.data&&e.data.timestamp!==a){let a=(0,f.getData)(e.data.pressure,t.unit);void 0!==a&&e.change(a),s(new Date(e.data.timestamp).getTime()),i[1]===e.classes.refreshStart?o([e.classes.autoRefresh,e.classes.refreshMid]):i[1]===e.classes.refreshMid?o([e.classes.autoRefresh,e.classes.refreshEnd]):o([e.classes.autoRefresh,e.classes.refreshStart])}return n().createElement(n().Fragment,null,n().createElement(d.Z,{className:e.classes.label},n().createElement(g.Z,{className:i,fontSize:"small"})))};v.propTypes={change:c().func.isRequired};var b=v,x=a(9895),E=a(8365),k=a(7748),y=a(7342),w=n().memo((e=>{const t=(0,r.useContext)(h);return console.log("Current Pressure updated"),n().createElement(n().Fragment,null,n().createElement(x.Z,{className:e.classes.paper},n().createElement(p.Z,{container:!0,direction:"column",justify:"space-between"},n().createElement(p.Z,{item:!0},n().createElement(p.Z,{container:!0,direction:"row",justify:"space-between"},n().createElement(d.Z,{className:e.classes.label,variant:"h6"},t.environment),n().createElement(d.Z,{className:e.classes.label,variant:"h6"},t.unit))),n().createElement(p.Z,{item:!0},n().createElement(d.Z,{gutterBottom:!0,variant:"h3"},void 0!==e.current&&null!==e.current?e.current.value:n().createElement(E.Z,{animation:"wave"})))),n().createElement(k.Z,{borderTop:1,className:e.classes.box,borderColor:"main",spacing:1,display:"flex",alignItems:"left"},n().createElement(y.Z,{className:e.classes.label,fontSize:"small"}),n().createElement(d.Z,{className:e.classes.label,variant:"caption"},"Â  ",void 0!==e.current&&null!==e.current?"Last updated "+new Date(e.current.time).toTimeString().split(" ")[0]:"waiting ..."))))})),S=(0,a(1120).Z)((e=>({root:{height:"90vh",color:e.palette.primary.main},header:{backgroundColor:e.palette.primary.main,padding:"0px",maxHeight:"10vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:"calc(10px + 2vmin)",color:"white"},container:{padding:"20px",minHeight:"85vh",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"calc(10px + 1vmin)"},paper:{width:"100%",height:"100%",minHeight:"calc(10px + 8vmin)",padding:e.spacing(1),textAlign:"center",color:e.palette.text.main,backgroundColor:e.palette.primary.dark},messages:{minHeight:"calc(10px + 6vmin)",marginTop:"1vmin",padding:0,textAlign:"bottom",color:e.palette.text.main,backgroundColor:e.palette.primary.dark},label:{color:e.palette.text.dark},placeholder:{justifyContent:"center"},box:{borderColor:e.palette.primary.main,color:e.palette.primary.main},card:{width:"32%",height:"100%",backgroundColor:e.palette.primary.dark,color:e.palette.text.main},alerts:{marginTop:"5px",width:"100%","& > * + *":{marginTop:e.spacing(2)}},alert:{marginTop:"1vmin"},autoRefresh:{transition:e.transitions.create(["transform"],{duration:e.transitions.duration.short})},refreshStart:{transform:"rotate(0)"},refreshMid:{transform:"rotate(120deg)"},refreshEnd:{transform:"rotate(240deg)"},graph:{backgroundColor:e.palette.primary.dark,grid:e.palette.text.light,text:e.palette.text.main,legend:e.palette.text.dark},footer:{backgroundColor:e.palette.primary.dark,padding:"0px",maxHeight:"5vh",display:"bottom",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:"calc(10px + 0vmin)",color:e.palette.text.dark}})));const C={unit:"hPa",environment:"Pressure",trending:{snap:"3h",threshold:.5},elevation:0};var Z=e=>{const t=S(),[a,s]=(0,r.useState)(null),[i,l]=(0,r.useState)((()=>(0,f.queryData)(C.environment,a)||[])),[c,d]=((0,r.useContext)(o),(0,r.useState)(3));return n().createElement("div",{className:t.paper},n().createElement(m.ZP,null),n().createElement(h.Provider,{value:C},n().createElement(u.Z,{className:t.container},n().createElement(p.Z,{container:!0,spacing:c},n().createElement(p.Z,{item:!0,xs:12,sm:12,justify:"flex-end"},n().createElement(b,{classes:t,data:e.data,change:e=>{null!==e&&(s(e),l((e=>[...i,e])))}})),n().createElement(p.Z,{item:!0,xs:12,sm:12},n().createElement(w,{classes:t,current:a}))))))};const D=a(306).name.replace(/[-@/]/g,"_"),j=()=>{try{const e=JSON.parse(localStorage.getItem(D));if(e.config)return e.config}catch(e){return{header:"off",footer:"off",interval:1e4,type:"Barometer"}}},N=(0,s.Z)({palette:{primary:{main:"#26323F"},secondary:{main:"#A63400"},text:{light:"#97C8EB",main:"#7DBBE6",dark:"#5782A1"},success:{main:"#7DBBE6"},info:{main:"#5782A1"},contrastThreshold:3,tonalOffset:.2,background:{default:"#26323F"}}}),I={"environment.outside.pressure":(e,t)=>(0,f.onPressureUpdate)(e,t),"environment.barometer.trend":(e,t)=>(0,f.onTrendUpdate)(e,t),"environment.barometer.description":(e,t)=>(0,f.onWeatherUpdate)(e,t)};var T=e=>{const[t,a]=(0,r.useState)({}),[s,l]=(0,r.useState)((0,f.getInitial)().values),[c,m]=(0,r.useState)((0,f.getInitial)().info),[u,p]=(0,r.useState)(j);return(0,r.useEffect)((()=>{if(e.adminUI.getApplicationUserData("0.1.0").then((e=>{a(e)})),e.loginStatus==={}||"notLoggedIn"===e.loginStatus.status&&e.loginStatus.authenticationRequired)return n().createElement(e.adminUI.Login,null);const t=e.adminUI.openWebsocket({subscribe:"none"});t.onopen=()=>{t.send(JSON.stringify({context:"vessels.self",subscribe:Object.keys(I).map((e=>({path:e})))}))},t.onmessage=e=>{const t=JSON.parse(e.data);(t.updates||[]).forEach((e=>{(e.values||[]).forEach((e=>{const a=I[e.path];if(m({delta:t}),a&&a(e.value,u.interval))if("environment.outside.pressure"===e.path){let e=(0,f.getLatest)().values;l(e)}else{let e=(0,f.getLatest)().info;m(e)}}))}))}}),[e.adminUI]),n().createElement("div",null,n().createElement(n().StrictMode,null,n().createElement(i.Z,{theme:N},n().createElement(o.Provider,{value:u},JSON.stringify(s),n().createElement(Z,{data:s})))))}},5305:function(e){const t={timestamp:Date.now(),pressure:null,trend:null},a={timestamp:Date.now(),description:"initializing ..."},r={timestamp:t.timestamp,pressure:{value:null,time:null},trend:{value:null,time:null}},n={description:a.description};e.exports={getInitial:function(){return{values:t,info:a}},getLatest:function(){return{values:r,info:n}},onPressureUpdate:function(e,t){return Date.now()-r.pressure.time>t&&(r.pressure.time=Date.now(),r.pressure.value!==e&&(r.timestamp=r.pressure.time),r.pressure.value=(e/100).toFixed(2),!0)},onTrendUpdate:function(e,t){return Date.now()-r.pressure.time>t&&(r.trend.time=Date.now(),r.trend.value!==e&&(r.timestamp=r.trend.time),r.trend.value=(e/100).toFixed(2),!0)},onWeatherUpdate:function(e,t){return Date.now()-r.pressure.time>t&&(n.description=e,n.description!==e&&(n.timestamp=Date.now()),!0)},getData:function(e,t){try{if(null!==e)return{value:e.value,time:e.time,unit:t}}catch(e){console.error(`Error converting item to ${t}`,e)}},queryData:function(e,t){try{let e=[];return t&&null!==t&&e.push({value:t.value,timestamp:t.time}),e}catch(t){console.error(`Error getting item ${e} from SignalK/influx`,t)}}}},306:function(e){"use strict";e.exports=JSON.parse('{"name":"signalk-barograph","description":"Barograph component visualizing atmospheric pressure data and barometer trends","version":"0.1.0","main":"index.js","private":true,"keywords":["signalk-embeddable-webapp"],"author":"tkrofta","license":"Apache-2.0","dependencies":{"@fontsource/roboto":"^4.2.2","@material-ui/core":"^4.11.3","@material-ui/icons":"^4.11.2","@material-ui/lab":"^4.0.0-alpha.57","@testing-library/jest-dom":"^5.11.9","@testing-library/react":"^11.2.5","@testing-library/user-event":"^12.8.3","chart.js":"^2.9.4","fontsource-roboto":"^4.0.0","react":"^17.0.1","react-chartjs-2":"^2.11.1","react-dom":"^17.0.1","react-scripts":"4.0.3","web-vitals":"^1.1.0"},"scripts":{"dev":"webpack --watch --mode development","start":"webpack serve --open --config webpack.config.js","build":"webpack --config webpack.prod.js","test":"react-scripts test","eject":"react-scripts eject"},"eslintConfig":{"extends":["react-app","react-app/jest"]},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"homepage":".","devDependencies":{"@babel/core":"^7.13.10","@babel/preset-react":"^7.12.13","babel-loader":"^8.2.2","html-webpack-plugin":"^5.3.1","webpack":"^5.27.2","webpack-cli":"^4.5.0"}}')}}]);